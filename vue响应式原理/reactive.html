<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>

        function defineReactive(obj, key, value) {
            if(value instanceof Object && value !== null) {
                observer(value)
            }

            Object.defineProperty(obj, key, {
                get(){
                    console.log('获取属性')
                    return value
                },
                set(newVal) {
                    console.log('设置属性', newVal)
                    value = newVal
                }
            })
        }

        function observerArray(arrayVal) {
            let originalArrayProto = Array.prototype
            let newArrayProto = Object.create(originalArrayProto)

            arrayVal.__proto__ = newArrayProto // 数组调用方法时，原型dispatcher会拦截

            let arrayMethods = ['push', 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse']
            
            arrayMethods.forEach(method => {
                newArrayProto[method] = function() {
                    console.log('拦截数组')
                    console.log(this)
                    // originalArrayProto[method].call(this, ...arguments)
                    originalArrayProto[method].call(this,...arguments)
                }
            })

            arrayVal.forEach(item => {
                if(item instanceof Object && item !== null) {
                    observer(item)
                }
            })
        }

        function observer(obj) {
            if(Array.isArray(obj)) {
                observerArray(obj)
            } else {
                for(let key in obj) {
                    defineReactive(obj, key, obj[key])
                }
            }
        }


        let obj = {
            a: 1,
            b: '2',
            c: [3,4, {g: 8}, [9,10]],
            d: {
                e: 5,
                f: [6,7]
            },
            h: null
        }

        observer(obj)
        obj.a
        obj.a = 1
        console.log(obj)
    </script>
</body>
</html>